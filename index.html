<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#317EFB">
    <title>Assembly to Machine Code</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <script src="keystone.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Welcome to My Website!</h1>
        <p>This is my first GitHub Pages website.</p>

        <h2>Assembly Code:</h2>
        <pre><code class="assembly-code">
inc   rax;
call  0x10040;
mov   rax, qword ptr[rdx + 4];
sub   esp, 0x100;
pop   rbx;
        </code></pre>

        <h2>Machine Code:</h2>
        <pre><code id="machine-code" class="machine-code"></code></pre>
    </div>

    <script>
        // Input: Assembly
        var assembly = `
          inc   rax;
          call  0x10040;
          mov   rax, qword ptr[rdx + 4];
          sub   esp, 0x100;
          pop   rbx;
        `;

        try {
            // Initialize the encoder
            var a = new ks.Keystone(ks.ARCH_X86, ks.MODE_64);

            // Choose preferred syntax
            a.option(ks.OPT_SYNTAX, ks.OPT_SYNTAX_INTEL);

            // Assemble instructions
            var result = a.asm(assembly);

            // Check if assembly succeeded
            if (result.failed) {
                console.error("Assembly failed:", result.error);
                document.getElementById("machine-code").textContent = "Assembly failed: " + result.error;
            } else {
                console.log("Assembly succeeded!");
                console.log("Number of instructions:", result.count);
                console.log("Machine code:", result.mc);

                // Display machine code on the webpage
                var machineCodeHex = Array.from(result.mc).map(b => b.toString(16).padStart(2, '0')).join(' ');
                document.getElementById("machine-code").textContent = machineCodeHex;
            }

            // Close encoder
            a.close();
        } catch (error) {
            console.error("An error occurred:", error);
            document.getElementById("machine-code").textContent = "An error occurred: " + error;
        }
    </script>
</body>
</html>
